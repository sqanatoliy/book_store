# Books ETL Pipeline

–ü—Ä–æ—Å—Ç–∏–π **ETL-–ø–∞–π–ø–ª–∞–π–Ω** (Extract ‚Üí Transform ‚Üí Load) –¥–ª—è PostgreSQL, —è–∫–∏–π:
- —á–∏—Ç–∞—î –∫–Ω–∏–≥–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ `books` –∑–∞ —É–º–æ–≤–æ—é `last_updated >= cutoff_date`
- —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î –¥–∞–Ω—ñ (–æ–∫—Ä—É–≥–ª–µ–Ω–Ω—è —Ü—ñ–Ω–∏ + –∫–∞—Ç–µ–≥–æ—Ä—ñ—è `budget/premium`)
- –∑–∞–ø–∏—Å—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É —Ç–∞–±–ª–∏—Ü—é `books_processed`

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

- `books_schema.sql` ‚Äî —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å, —ñ–Ω–¥–µ–∫—Å—ñ–≤, —Ç—Ä–∏–≥–µ—Ä–∞ —Ç–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö (6 —Ä—è–¥–∫—ñ–≤)
- `books_etl.py` ‚Äî ETL-—Å–∫—Ä–∏–ø—Ç
- `requirements.txt` ‚Äî Python-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

---

## –í–∏–º–æ–≥–∏

- Python 3.10+ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
- PostgreSQL (–ª–æ–∫–∞–ª—å–Ω–æ –∞–±–æ —Ö–º–∞—Ä–Ω–∏–π, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ Neon)
- `psql` (–∞–±–æ —ñ–Ω—à–∏–π –∫–ª—ñ—î–Ω—Ç), —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ `books_schema.sql`

---

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ –æ—Ç–æ—á–µ–Ω–Ω—è:

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

---

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è PostgreSQL

### 1) –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–∏ —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ø—Ä–∏–∫–ª–∞–¥)

```bash
psql -h localhost -U <your_admin_user> -d postgres
```

```sql
CREATE USER books_user WITH PASSWORD 'books_pass';
CREATE DATABASE books_db OWNER books_user;
\q
```

> –Ø–∫—â–æ –±–∞–∑–∞/–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–∂–µ —ñ—Å–Ω—É—é—Ç—å ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏ —Ü–µ–π –∫—Ä–æ–∫ —ñ –ø—Ä–æ—Å—Ç–æ –ø—ñ–¥—Å—Ç–∞–≤ —Å–≤–æ—ó –∑–Ω–∞—á–µ–Ω–Ω—è –≤ `.env`.

### 2) –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ö–µ–º–∏ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

```bash
psql -h localhost -U books_user -d books_db -f books_schema.sql
```

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:

```bash
psql -h localhost -U books_user -d books_db -c "SELECT count(*) FROM books;"
```

–û—á—ñ–∫—É–≤–∞–Ω–æ: `6`.

> –£ `books_schema.sql` —î `TRUNCATE` –ø–µ—Ä–µ–¥ `INSERT`, —â–æ–± —É–Ω–∏–∫–∞—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω—å –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö. –Ø–∫—â–æ —Ü–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî –º–æ–∂–Ω–∞ –ø—Ä–∏–±–µ—Ä–∞—Ç–∏ –±–ª–æ–∫ `TRUNCATE`.

---

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (.env)

–°–∫—Ä–∏–ø—Ç —á–∏—Ç–∞—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑ environment variables. –¢–∞–∫–æ–∂ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —Ñ–∞–π–ª `.env` —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ—î–∫—Ç—É —á–µ—Ä–µ–∑ **python-decouple**.

–°—Ç–≤–æ—Ä–∏ `.env`:

```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=books_db
DB_USER=books_user
DB_PASSWORD=books_pass
```

 –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–æ –æ–±–æ–≤ º—è–∑–∫–æ–≤—ñ –¥–ª—è —Ü—å–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É: `DB_USER`, `DB_PASSWORD` (—ñ–Ω—à—ñ –º–∞—é—Ç—å –¥–µ—Ñ–æ–ª—Ç–∏, –∞–ª–µ –∫—Ä–∞—â–µ —è–≤–Ω–æ –∑–∞–¥–∞—Ç–∏ –≤—Å—ñ).

---

## –ó–∞–ø—É—Å–∫ ETL

–°–∫—Ä–∏–ø—Ç –ø—Ä–∏–π–º–∞—î **–æ–¥–∏–Ω –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç** ‚Äî `cutoff_date` —É —Ñ–æ—Ä–º–∞—Ç—ñ `YYYY-MM-DD` (–≤–∫–ª—é—á–Ω–æ).

```bash
python books_etl.py 2025-01-01
```

### –ü—Ä–∏–∫–ª–∞–¥ –æ—á—ñ–∫—É–≤–∞–Ω–æ–≥–æ –≤–∏–≤–æ–¥—É (—î –¥–∞–Ω—ñ)
```
–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É—Å–ø—ñ—à–Ω–µ
–í–∏—Ç—è–≥–Ω—É—Ç–æ 4 –∑–∞–ø–∏—Å—ñ–≤ –∑ —Ç–∞–±–ª–∏—Ü—ñ books
–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ 4 –∑–∞–ø–∏—Å—ñ–≤
–ó–±–µ—Ä–µ–∂–µ–Ω–æ 4 –∑–∞–ø–∏—Å—ñ–≤ –≤ books_processed
ETL –ø—Ä–æ—Ü–µ—Å –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ
```

### –Ø–∫—â–æ –¥–∞–Ω–∏—Ö –Ω–µ–º–∞—î
```
–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É—Å–ø—ñ—à–Ω–µ
–í–∏—Ç—è–≥–Ω—É—Ç–æ 0 –∑–∞–ø–∏—Å—ñ–≤ –∑ —Ç–∞–±–ª–∏—Ü—ñ books
–ù–æ–≤–∏—Ö –∫–Ω–∏–≥ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–∞ –≤–∫–∞–∑–∞–Ω—É –¥–∞—Ç—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –†–æ–±–æ—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ
```

---

## üîé –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

```bash
psql -h localhost -U books_user -d books_db -c "SELECT * FROM books_processed ORDER BY processed_id;"
```

---

## –¢–∏–ø–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏

- **`–ù–µ –≤–∫–∞–∑–∞–Ω–∞ –æ–±–æ–≤'—è–∑–∫–æ–≤–∞ –∑–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞`**  
  –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ `.env` –ª–µ–∂–∏—Ç—å –≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ—î–∫—Ç—É (–∞–±–æ –∑–º—ñ–Ω–Ω—ñ –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ –≤ shell).

- **`relation "books" does not exist`**  
  –ù–µ –≤–∏–∫–æ–Ω–∞–Ω–æ `books_schema.sql`

- **–ü–æ–≤—Ç–æ—Ä–Ω–∏–π –∑–∞–ø—É—Å–∫ ETL –¥–æ–¥–∞—î –¥—É–±–ª—ñ–∫–∞—Ç–∏ –≤ `books_processed`**  
  –¶–µ –æ—á—ñ–∫—É–≤–∞–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ (`to_sql(if_exists='append')`)

---

## –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –±–µ—Ä—É—Ç—å—Å—è –∑ `requirements.txt`:
- `python-decouple`
- `pandas`
- `SQLAlchemy`
- `psycopg2-binary`
